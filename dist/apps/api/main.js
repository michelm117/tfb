(()=>{"use strict";var __webpack_modules__={6454:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),api_interfaces_1=__webpack_require__(7573),app_service_1=__webpack_require__(8968);let AppController=class AppController{constructor(appService){this.appService=appService}getData(){return this.appService.getData()}};tslib_1.__decorate([(0,common_1.Get)("hello"),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype","function"==typeof(_a=void 0!==api_interfaces_1.Message&&api_interfaces_1.Message)?_a:Object)],AppController.prototype,"getData",null),AppController=tslib_1.__decorate([(0,common_1.Controller)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_b=void 0!==app_service_1.AppService&&app_service_1.AppService)?_b:Object])],AppController),exports.AppController=AppController},3292:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),typeorm_1=__webpack_require__(3399),app_controller_1=__webpack_require__(6454),app_service_1=__webpack_require__(8968),core_1=__webpack_require__(7840),config_1=__webpack_require__(5793);let AppModule=class AppModule{};AppModule=tslib_1.__decorate([(0,common_1.Module)({imports:[config_1.ConfigModule.forRoot({isGlobal:!0,envFilePath:".env"}),typeorm_1.TypeOrmModule.forRootAsync({imports:[config_1.ConfigModule],inject:[config_1.ConfigService],useFactory:configService=>({type:"postgres",host:configService.get("POSTGRES_HOST"),port:configService.get("POSTGRES_PORT"),username:configService.get("POSTGRES_USER"),password:configService.get("POSTGRES_PASSWORD"),database:configService.get("POSTGRES_DB"),entities:[core_1.Rider,core_1.Country,core_1.About,core_1.Story,core_1.Result,core_1.AgeCategory,core_1.Race,core_1.User],synchronize:!0,logging:!0})}),core_1.RidersModule,core_1.CountryModule,core_1.AboutModule,core_1.StoriesModule,core_1.RacesModule,core_1.AgeCategoryModule,core_1.ResultModule,core_1.UserModule,core_1.AuthModule],controllers:[app_controller_1.AppController],providers:[app_service_1.AppService]})],AppModule),exports.AppModule=AppModule},8968:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481);let AppService=class AppService{getData(){return{message:"Welcome to api!"}}};AppService=tslib_1.__decorate([(0,common_1.Injectable)()],AppService),exports.AppService=AppService},7553:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.environment=void 0,exports.environment={production:!0}},7573:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__(752);tslib_1.__exportStar(__webpack_require__(6870),exports),tslib_1.__exportStar(__webpack_require__(8181),exports),tslib_1.__exportStar(__webpack_require__(5297),exports),tslib_1.__exportStar(__webpack_require__(6566),exports),tslib_1.__exportStar(__webpack_require__(1266),exports),tslib_1.__exportStar(__webpack_require__(319),exports),tslib_1.__exportStar(__webpack_require__(2752),exports),tslib_1.__exportStar(__webpack_require__(115),exports),tslib_1.__exportStar(__webpack_require__(6298),exports),tslib_1.__exportStar(__webpack_require__(7826),exports),tslib_1.__exportStar(__webpack_require__(7136),exports),tslib_1.__exportStar(__webpack_require__(6626),exports),tslib_1.__exportStar(__webpack_require__(2266),exports)},6870:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},8181:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},5297:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},6566:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},1266:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},319:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},2752:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},6626:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},115:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},6298:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},7826:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},7136:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},2266:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},7840:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__(752);tslib_1.__exportStar(__webpack_require__(9437),exports),tslib_1.__exportStar(__webpack_require__(5321),exports),tslib_1.__exportStar(__webpack_require__(7487),exports),tslib_1.__exportStar(__webpack_require__(6281),exports),tslib_1.__exportStar(__webpack_require__(3763),exports),tslib_1.__exportStar(__webpack_require__(3028),exports),tslib_1.__exportStar(__webpack_require__(5057),exports),tslib_1.__exportStar(__webpack_require__(376),exports),tslib_1.__exportStar(__webpack_require__(8942),exports),tslib_1.__exportStar(__webpack_require__(1628),exports),tslib_1.__exportStar(__webpack_require__(4514),exports),tslib_1.__exportStar(__webpack_require__(2074),exports),tslib_1.__exportStar(__webpack_require__(4794),exports),tslib_1.__exportStar(__webpack_require__(633),exports),tslib_1.__exportStar(__webpack_require__(5713),exports),tslib_1.__exportStar(__webpack_require__(1501),exports),tslib_1.__exportStar(__webpack_require__(7080),exports)},1098:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AboutController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),about_service_1=__webpack_require__(4274),create_about_dto_1=__webpack_require__(8361),update_about_dto_1=__webpack_require__(2424);let AboutController=class AboutController{constructor(aboutService){this.aboutService=aboutService}create(createAboutDto){return this.aboutService.create(createAboutDto)}find(){return this.aboutService.find()}count(){return this.aboutService.count()}update(updateAboutDto){return this.aboutService.update(updateAboutDto)}};tslib_1.__decorate([(0,common_1.Post)(),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==create_about_dto_1.CreateAboutDto&&create_about_dto_1.CreateAboutDto)?_a:Object]),tslib_1.__metadata("design:returntype",void 0)],AboutController.prototype,"create",null),tslib_1.__decorate([(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],AboutController.prototype,"find",null),tslib_1.__decorate([(0,common_1.Get)("count"),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],AboutController.prototype,"count",null),tslib_1.__decorate([(0,common_1.Patch)(),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_b=void 0!==update_about_dto_1.UpdateAboutDto&&update_about_dto_1.UpdateAboutDto)?_b:Object]),tslib_1.__metadata("design:returntype",void 0)],AboutController.prototype,"update",null),AboutController=tslib_1.__decorate([(0,common_1.Controller)("abouttext"),tslib_1.__metadata("design:paramtypes",["function"==typeof(_c=void 0!==about_service_1.AboutService&&about_service_1.AboutService)?_c:Object])],AboutController),exports.AboutController=AboutController},3763:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AboutModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),about_service_1=__webpack_require__(4274),about_controller_1=__webpack_require__(1098),about_entity_1=__webpack_require__(3028),typeorm_1=__webpack_require__(3399);let AboutModule=class AboutModule{};AboutModule=tslib_1.__decorate([(0,common_1.Module)({imports:[typeorm_1.TypeOrmModule.forFeature([about_entity_1.About])],controllers:[about_controller_1.AboutController],providers:[about_service_1.AboutService]})],AboutModule),exports.AboutModule=AboutModule},4274:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AboutService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),typeorm_1=__webpack_require__(3399),typeorm_2=__webpack_require__(5250),about_entity_1=__webpack_require__(3028);let AboutService=class AboutService{constructor(aboutRepository){this.aboutRepository=aboutRepository}create(createAboutDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(0!==(yield this.count()))return new common_1.BadRequestException("About text already exists");const aboutText=this.aboutRepository.create(createAboutDto);return yield this.aboutRepository.save(aboutText)}))}count(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.aboutRepository.count()}))}find(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.aboutRepository.find()}))}update(updateAboutDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(0===(yield this.count()))return new common_1.BadRequestException("About text cant be updated. Text doesn't exists yet");const abouts=yield this.find();return yield this.aboutRepository.update(abouts[0].id,updateAboutDto)}))}};AboutService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,typeorm_1.InjectRepository)(about_entity_1.About)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==typeorm_2.Repository&&typeorm_2.Repository)?_a:Object])],AboutService),exports.AboutService=AboutService},8361:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateAboutDto=void 0;exports.CreateAboutDto=class CreateAboutDto{}},2424:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UpdateAboutDto=void 0;const mapped_types_1=__webpack_require__(2568),create_about_dto_1=__webpack_require__(8361);class UpdateAboutDto extends((0,mapped_types_1.PartialType)(create_about_dto_1.CreateAboutDto)){}exports.UpdateAboutDto=UpdateAboutDto},3028:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.About=void 0;const tslib_1=__webpack_require__(752),typeorm_1=__webpack_require__(5250);let About=class About{};tslib_1.__decorate([(0,typeorm_1.PrimaryGeneratedColumn)(),tslib_1.__metadata("design:type",Number)],About.prototype,"id",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],About.prototype,"text",void 0),About=tslib_1.__decorate([(0,typeorm_1.Entity)()],About),exports.About=About},6608:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AgeCategoryController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),age_category_service_1=__webpack_require__(6153),create_age_category_dto_1=__webpack_require__(6240),update_age_category_dto_1=__webpack_require__(1136);let AgeCategoryController=class AgeCategoryController{constructor(ageCategoryService){this.ageCategoryService=ageCategoryService}create(createAgeCategoryDto){return this.ageCategoryService.create(createAgeCategoryDto)}findAll(){return this.ageCategoryService.findAll()}findOne(id){return this.ageCategoryService.findOne(+id)}update(id,updateAgeCategoryDto){return this.ageCategoryService.update(+id,updateAgeCategoryDto)}remove(id){return this.ageCategoryService.remove(+id)}};tslib_1.__decorate([(0,common_1.Post)(),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==create_age_category_dto_1.CreateAgeCategoryDto&&create_age_category_dto_1.CreateAgeCategoryDto)?_a:Object]),tslib_1.__metadata("design:returntype",void 0)],AgeCategoryController.prototype,"create",null),tslib_1.__decorate([(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],AgeCategoryController.prototype,"findAll",null),tslib_1.__decorate([(0,common_1.Get)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],AgeCategoryController.prototype,"findOne",null),tslib_1.__decorate([(0,common_1.Patch)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__param(1,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_b=void 0!==update_age_category_dto_1.UpdateAgeCategoryDto&&update_age_category_dto_1.UpdateAgeCategoryDto)?_b:Object]),tslib_1.__metadata("design:returntype",void 0)],AgeCategoryController.prototype,"update",null),tslib_1.__decorate([(0,common_1.Delete)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],AgeCategoryController.prototype,"remove",null),AgeCategoryController=tslib_1.__decorate([(0,common_1.Controller)("age-category"),tslib_1.__metadata("design:paramtypes",["function"==typeof(_c=void 0!==age_category_service_1.AgeCategoryService&&age_category_service_1.AgeCategoryService)?_c:Object])],AgeCategoryController),exports.AgeCategoryController=AgeCategoryController},8942:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AgeCategoryModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),age_category_service_1=__webpack_require__(6153),age_category_controller_1=__webpack_require__(6608),age_category_entity_1=__webpack_require__(1628),typeorm_1=__webpack_require__(3399);let AgeCategoryModule=class AgeCategoryModule{};AgeCategoryModule=tslib_1.__decorate([(0,common_1.Module)({imports:[typeorm_1.TypeOrmModule.forFeature([age_category_entity_1.AgeCategory])],controllers:[age_category_controller_1.AgeCategoryController],providers:[age_category_service_1.AgeCategoryService]})],AgeCategoryModule),exports.AgeCategoryModule=AgeCategoryModule},6153:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AgeCategoryService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),typeorm_1=__webpack_require__(3399),typeorm_2=__webpack_require__(5250),age_category_entity_1=__webpack_require__(1628);let AgeCategoryService=class AgeCategoryService{constructor(ageCategoryRepository){this.ageCategoryRepository=ageCategoryRepository}create(createAgeCategoryDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const ageCategory=this.ageCategoryRepository.create(createAgeCategoryDto);return yield this.ageCategoryRepository.save(ageCategory),ageCategory}))}findAll(){return this.ageCategoryRepository.find()}findOne(id){return this.ageCategoryRepository.findOne({where:{id}})}update(id,updateAgeCategoryDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(yield this.ageCategoryRepository.findOneBy({id}))return yield this.ageCategoryRepository.update(id,updateAgeCategoryDto)}))}remove(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.ageCategoryRepository.delete(id)}))}};AgeCategoryService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,typeorm_1.InjectRepository)(age_category_entity_1.AgeCategory)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==typeorm_2.Repository&&typeorm_2.Repository)?_a:Object])],AgeCategoryService),exports.AgeCategoryService=AgeCategoryService},6240:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateAgeCategoryDto=void 0;exports.CreateAgeCategoryDto=class CreateAgeCategoryDto{}},1136:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UpdateAgeCategoryDto=void 0;const mapped_types_1=__webpack_require__(2568),create_age_category_dto_1=__webpack_require__(6240);class UpdateAgeCategoryDto extends((0,mapped_types_1.PartialType)(create_age_category_dto_1.CreateAgeCategoryDto)){}exports.UpdateAgeCategoryDto=UpdateAgeCategoryDto},1628:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AgeCategory=void 0;const tslib_1=__webpack_require__(752),typeorm_1=__webpack_require__(5250),result_entity_1=__webpack_require__(633);let AgeCategory=class AgeCategory{};tslib_1.__decorate([(0,typeorm_1.PrimaryGeneratedColumn)(),tslib_1.__metadata("design:type",Number)],AgeCategory.prototype,"id",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],AgeCategory.prototype,"name",void 0),tslib_1.__decorate([(0,typeorm_1.OneToMany)((()=>result_entity_1.Result),(result=>result.ageCategory)),tslib_1.__metadata("design:type",Array)],AgeCategory.prototype,"results",void 0),AgeCategory=tslib_1.__decorate([(0,typeorm_1.Entity)()],AgeCategory),exports.AgeCategory=AgeCategory},6589:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AuthController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),api_interfaces_1=__webpack_require__(7573),user_entity_1=__webpack_require__(1501),user_service_1=__webpack_require__(8081),auth_service_1=__webpack_require__(5026),register_dto_1=__webpack_require__(3283),jwt_auth_guard_1=__webpack_require__(838),jwt_refresh_guard_1=__webpack_require__(5732),local_auth_guard_1=__webpack_require__(2304);let AuthController=class AuthController{constructor(authService,userService){this.authService=authService,this.userService=userService}getUserInformation(req){return req.user}register(registrationData){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.authService.register(registrationData)}))}login(req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const{user}=req,accessTokenCookie=this.authService.getCookieWithJwtAccessToken(user.id),{cookie:refreshTokenCookie,token:refreshToken}=this.authService.getCookieWithJwtRefreshToken(user.id);return yield this.userService.setCurrentRefreshToken(refreshToken,user.id),req.res.setHeader("Set-Cookie",[accessTokenCookie,refreshTokenCookie]),user}))}logout(req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.userService.removeRefreshToken(req.user.id),req.res.setHeader("Set-Cookie",this.authService.getCookiesForLogout())}))}refresh(req){const accessTokenCookie=this.authService.getCookieWithJwtAccessToken(req.user.id);return req.res.setHeader("Set-Cookie",accessTokenCookie),req.user}};tslib_1.__decorate([(0,common_1.Get)(),(0,common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),tslib_1.__param(0,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==api_interfaces_1.RequestWithUser&&api_interfaces_1.RequestWithUser)?_a:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_b=void 0!==user_entity_1.User&&user_entity_1.User)?_b:Object)],AuthController.prototype,"getUserInformation",null),tslib_1.__decorate([(0,common_1.Post)("register"),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_c=void 0!==register_dto_1.RegisterDto&&register_dto_1.RegisterDto)?_c:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_d="undefined"!=typeof Promise&&Promise)?_d:Object)],AuthController.prototype,"register",null),tslib_1.__decorate([(0,common_1.HttpCode)(200),(0,common_1.Post)("login"),(0,common_1.UseGuards)(local_auth_guard_1.LocalAuthGuard),tslib_1.__param(0,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_e=void 0!==api_interfaces_1.RequestWithUser&&api_interfaces_1.RequestWithUser)?_e:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_f="undefined"!=typeof Promise&&Promise)?_f:Object)],AuthController.prototype,"login",null),tslib_1.__decorate([(0,common_1.HttpCode)(200),(0,common_1.Post)("logout"),(0,common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),tslib_1.__param(0,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_g=void 0!==api_interfaces_1.RequestWithUser&&api_interfaces_1.RequestWithUser)?_g:Object]),tslib_1.__metadata("design:returntype",Promise)],AuthController.prototype,"logout",null),tslib_1.__decorate([(0,common_1.Get)("refresh"),(0,common_1.UseGuards)(jwt_refresh_guard_1.default),tslib_1.__param(0,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_h=void 0!==api_interfaces_1.RequestWithUser&&api_interfaces_1.RequestWithUser)?_h:Object]),tslib_1.__metadata("design:returntype",Object)],AuthController.prototype,"refresh",null),AuthController=tslib_1.__decorate([(0,common_1.Controller)("auth"),(0,common_1.SerializeOptions)({strategy:"excludeAll"}),tslib_1.__metadata("design:paramtypes",["function"==typeof(_j=void 0!==auth_service_1.AuthService&&auth_service_1.AuthService)?_j:Object,"function"==typeof(_k=void 0!==user_service_1.UserService&&user_service_1.UserService)?_k:Object])],AuthController),exports.AuthController=AuthController},7080:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AuthModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),auth_service_1=__webpack_require__(5026),auth_controller_1=__webpack_require__(6589),user_module_1=__webpack_require__(5713),passport_1=__webpack_require__(4340),config_1=__webpack_require__(5793),jwt_1=__webpack_require__(2064),jwt_refresh_token_strategy_1=__webpack_require__(1537),jwt_strategy_1=__webpack_require__(8530),local_strategy_1=__webpack_require__(102);let AuthModule=class AuthModule{};AuthModule=tslib_1.__decorate([(0,common_1.Module)({imports:[user_module_1.UserModule,passport_1.PassportModule,config_1.ConfigModule,jwt_1.JwtModule.register({})],providers:[auth_service_1.AuthService,local_strategy_1.LocalStrategy,jwt_strategy_1.JwtStrategy,jwt_refresh_token_strategy_1.JwtRefreshTokenStrategy],controllers:[auth_controller_1.AuthController]})],AuthModule),exports.AuthModule=AuthModule},5026:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AuthService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),config_1=__webpack_require__(5793),jwt_1=__webpack_require__(2064),user_service_1=__webpack_require__(8081),bcrypt=__webpack_require__(7096);let AuthService=class AuthService{constructor(usersService,jwtService,configService){this.usersService=usersService,this.jwtService=jwtService,this.configService=configService}register(registrationData){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const hashedPassword=yield bcrypt.hash(registrationData.password,10);try{return yield this.usersService.create(Object.assign(Object.assign({},registrationData),{password:hashedPassword}))}catch(error){if("23505"===(null==error?void 0:error.code))throw new common_1.HttpException("A user with this email already exists. Use a different email.",common_1.HttpStatus.BAD_REQUEST);throw new common_1.HttpException("Something went wrong",common_1.HttpStatus.INTERNAL_SERVER_ERROR)}}))}getAuthenticatedUser(email,plainPassword){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.usersService.getByEmail(email);if(!user)throw new common_1.HttpException("Wrong credentials provided",common_1.HttpStatus.BAD_REQUEST);return yield this.verifyPassword(plainPassword,user.password),user}))}verifyPassword(plainPassword,hashedPassword){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(!(yield bcrypt.compare(plainPassword,hashedPassword)))throw new common_1.HttpException("Wrong credentials provided",common_1.HttpStatus.BAD_REQUEST)}))}getCookieWithJwtAccessToken(userId){const payload={userId};return`Authentication=${this.jwtService.sign(payload,{secret:this.configService.get("JWT_ACCESS_TOKEN_SECRET"),expiresIn:`${this.configService.get("JWT_ACCESS_TOKEN_EXPIRATION_TIME")}s`})};Path=/; Max-Age=${this.configService.get("JWT_ACCESS_TOKEN_EXPIRATION_TIME")}; Domain=michel.lu; SameSite=LAX`}getCookieWithJwtRefreshToken(userId){const payload={userId},token=this.jwtService.sign(payload,{secret:this.configService.get("JWT_REFRESH_TOKEN_SECRET"),expiresIn:`${this.configService.get("JWT_REFRESH_TOKEN_EXPIRATION_TIME")}s`});return{cookie:`Refresh=${token}; Path=/; Max-Age=${this.configService.get("JWT_REFRESH_TOKEN_EXPIRATION_TIME")}; Domain=michel.lu; SameSite=LAX`,token}}getCookiesForLogout(){return["Authentication=; Path=/; Max-Age=0; Domain=michel.lu; SameSite=LAX","Refresh=; Path=/; Max-Age=0; Domain=michel.lu; SameSite=LAX"]}};AuthService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==user_service_1.UserService&&user_service_1.UserService)?_a:Object,"function"==typeof(_b=void 0!==jwt_1.JwtService&&jwt_1.JwtService)?_b:Object,"function"==typeof(_c=void 0!==config_1.ConfigService&&config_1.ConfigService)?_c:Object])],AuthService),exports.AuthService=AuthService},3283:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.RegisterDto=void 0;const tslib_1=__webpack_require__(752),class_validator_1=__webpack_require__(5849);class RegisterDto{}tslib_1.__decorate([(0,class_validator_1.IsEmail)(),tslib_1.__metadata("design:type",String)],RegisterDto.prototype,"email",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)(),(0,class_validator_1.IsNotEmpty)(),(0,class_validator_1.MinLength)(8),tslib_1.__metadata("design:type",String)],RegisterDto.prototype,"password",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)(),(0,class_validator_1.IsNotEmpty)(),tslib_1.__metadata("design:type",String)],RegisterDto.prototype,"name",void 0),exports.RegisterDto=RegisterDto},838:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.JwtAuthGuard=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),passport_1=__webpack_require__(4340);let JwtAuthGuard=class JwtAuthGuard extends((0,passport_1.AuthGuard)("jwt")){};JwtAuthGuard=tslib_1.__decorate([(0,common_1.Injectable)()],JwtAuthGuard),exports.JwtAuthGuard=JwtAuthGuard},5732:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),passport_1=__webpack_require__(4340);let JwtRefreshGuard=class JwtRefreshGuard extends((0,passport_1.AuthGuard)("jwt-refresh-token")){};JwtRefreshGuard=tslib_1.__decorate([(0,common_1.Injectable)()],JwtRefreshGuard),exports.default=JwtRefreshGuard},2304:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.LocalAuthGuard=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),passport_1=__webpack_require__(4340);let LocalAuthGuard=class LocalAuthGuard extends((0,passport_1.AuthGuard)("local")){};LocalAuthGuard=tslib_1.__decorate([(0,common_1.Injectable)()],LocalAuthGuard),exports.LocalAuthGuard=LocalAuthGuard},1537:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.JwtRefreshTokenStrategy=void 0;const tslib_1=__webpack_require__(752),passport_jwt_1=__webpack_require__(9849),passport_1=__webpack_require__(4340),common_1=__webpack_require__(6481),config_1=__webpack_require__(5793),user_service_1=__webpack_require__(8081),auth_service_1=__webpack_require__(5026);let JwtRefreshTokenStrategy=class JwtRefreshTokenStrategy extends((0,passport_1.PassportStrategy)(passport_jwt_1.Strategy,"jwt-refresh-token")){constructor(userService,authService,configService){super({jwtFromRequest:passport_jwt_1.ExtractJwt.fromExtractors([request=>{var _a;return null===(_a=null==request?void 0:request.cookies)||void 0===_a?void 0:_a.Refresh}]),secretOrKey:configService.get("JWT_REFRESH_TOKEN_SECRET"),passReqToCallback:!0}),this.userService=userService,this.authService=authService}validate(req,payload){var _a;return tslib_1.__awaiter(this,void 0,void 0,(function*(){const refreshToken=null===(_a=req.cookies)||void 0===_a?void 0:_a.Refresh,user=yield this.userService.getUserIfRefreshTokenMatches(refreshToken,payload.userId);return user||req.res.setHeader("Set-Cookie",this.authService.getCookiesForLogout()),user}))}};JwtRefreshTokenStrategy=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==user_service_1.UserService&&user_service_1.UserService)?_a:Object,"function"==typeof(_b=void 0!==auth_service_1.AuthService&&auth_service_1.AuthService)?_b:Object,"function"==typeof(_c=void 0!==config_1.ConfigService&&config_1.ConfigService)?_c:Object])],JwtRefreshTokenStrategy),exports.JwtRefreshTokenStrategy=JwtRefreshTokenStrategy},8530:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.JwtStrategy=void 0;const tslib_1=__webpack_require__(752),passport_jwt_1=__webpack_require__(9849),passport_1=__webpack_require__(4340),common_1=__webpack_require__(6481),config_1=__webpack_require__(5793),user_service_1=__webpack_require__(8081);let JwtStrategy=class JwtStrategy extends((0,passport_1.PassportStrategy)(passport_jwt_1.Strategy)){constructor(configService,userService){super({jwtFromRequest:passport_jwt_1.ExtractJwt.fromExtractors([request=>{var _a;return null===(_a=null==request?void 0:request.cookies)||void 0===_a?void 0:_a.Authentication}]),secretOrKey:configService.get("JWT_ACCESS_TOKEN_SECRET"),ignoreExpiration:!1,passReqToCallback:!1}),this.userService=userService}validate(payload){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.userService.getById(payload.userId)}))}};JwtStrategy=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==config_1.ConfigService&&config_1.ConfigService)?_a:Object,"function"==typeof(_b=void 0!==user_service_1.UserService&&user_service_1.UserService)?_b:Object])],JwtStrategy),exports.JwtStrategy=JwtStrategy},102:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.LocalStrategy=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),auth_service_1=__webpack_require__(5026),passport_1=__webpack_require__(4340),passport_local_1=__webpack_require__(7055);let LocalStrategy=class LocalStrategy extends((0,passport_1.PassportStrategy)(passport_local_1.Strategy)){constructor(authService){super({usernameField:"email"}),this.authService=authService}validate(username,password){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.authService.getAuthenticatedUser(username,password)}))}};LocalStrategy=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==auth_service_1.AuthService&&auth_service_1.AuthService)?_a:Object])],LocalStrategy),exports.LocalStrategy=LocalStrategy},7073:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CountryController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),country_service_1=__webpack_require__(6193),create_country_dto_1=__webpack_require__(2047),update_country_dto_1=__webpack_require__(80);let CountryController=class CountryController{constructor(countryService){this.countryService=countryService}create(createCountryDto){return this.countryService.create(createCountryDto)}findAll(){return this.countryService.findAll()}findOneByIso(iso){return this.countryService.findOneByIso(iso)}findOne(id){return this.countryService.findOne(+id)}update(id,updateCountryDto){return this.countryService.update(+id,updateCountryDto)}remove(id){return this.countryService.remove(+id)}};tslib_1.__decorate([(0,common_1.Post)(),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==create_country_dto_1.CreateCountryDto&&create_country_dto_1.CreateCountryDto)?_a:Object]),tslib_1.__metadata("design:returntype",void 0)],CountryController.prototype,"create",null),tslib_1.__decorate([(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],CountryController.prototype,"findAll",null),tslib_1.__decorate([(0,common_1.Get)(":iso"),tslib_1.__param(0,(0,common_1.Param)("iso")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],CountryController.prototype,"findOneByIso",null),tslib_1.__decorate([(0,common_1.Get)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],CountryController.prototype,"findOne",null),tslib_1.__decorate([(0,common_1.Patch)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__param(1,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_b=void 0!==update_country_dto_1.UpdateCountryDto&&update_country_dto_1.UpdateCountryDto)?_b:Object]),tslib_1.__metadata("design:returntype",void 0)],CountryController.prototype,"update",null),tslib_1.__decorate([(0,common_1.Delete)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],CountryController.prototype,"remove",null),CountryController=tslib_1.__decorate([(0,common_1.Controller)("country"),tslib_1.__metadata("design:paramtypes",["function"==typeof(_c=void 0!==country_service_1.CountryService&&country_service_1.CountryService)?_c:Object])],CountryController),exports.CountryController=CountryController},7487:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CountryModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),country_service_1=__webpack_require__(6193),country_controller_1=__webpack_require__(7073),country_entity_1=__webpack_require__(6281),typeorm_1=__webpack_require__(3399);let CountryModule=class CountryModule{};CountryModule=tslib_1.__decorate([(0,common_1.Module)({imports:[typeorm_1.TypeOrmModule.forFeature([country_entity_1.Country])],controllers:[country_controller_1.CountryController],providers:[country_service_1.CountryService]})],CountryModule),exports.CountryModule=CountryModule},6193:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CountryService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),country_entity_1=__webpack_require__(6281),typeorm_1=__webpack_require__(3399),typeorm_2=__webpack_require__(5250);let CountryService=class CountryService{constructor(countryRepository){this.countryRepository=countryRepository}create(createCountryDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const country=this.countryRepository.create(createCountryDto);return yield this.countryRepository.save(country),country}))}findAll(){return this.countryRepository.find()}findOneByIso(iso){return this.countryRepository.find({where:{iso}})}findOne(id){return this.countryRepository.findOneBy({id})}update(id,updateCountryDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(yield this.countryRepository.findOneBy({id}))return yield this.countryRepository.update(id,updateCountryDto)}))}remove(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.countryRepository.delete(id)}))}};CountryService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,typeorm_1.InjectRepository)(country_entity_1.Country)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==typeorm_2.Repository&&typeorm_2.Repository)?_a:Object])],CountryService),exports.CountryService=CountryService},2047:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateCountryDto=void 0;exports.CreateCountryDto=class CreateCountryDto{}},80:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UpdateCountryDto=void 0;const mapped_types_1=__webpack_require__(2568),create_country_dto_1=__webpack_require__(2047);class UpdateCountryDto extends((0,mapped_types_1.PartialType)(create_country_dto_1.CreateCountryDto)){}exports.UpdateCountryDto=UpdateCountryDto},6281:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.Country=void 0;const tslib_1=__webpack_require__(752),typeorm_1=__webpack_require__(5250),rider_entity_1=__webpack_require__(5321),story_entity_1=__webpack_require__(376);let Country=class Country{};tslib_1.__decorate([(0,typeorm_1.PrimaryGeneratedColumn)(),tslib_1.__metadata("design:type",Number)],Country.prototype,"id",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],Country.prototype,"name",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],Country.prototype,"iso",void 0),tslib_1.__decorate([(0,typeorm_1.OneToMany)((()=>rider_entity_1.Rider),(rider=>rider.country)),tslib_1.__metadata("design:type",Array)],Country.prototype,"riders",void 0),tslib_1.__decorate([(0,typeorm_1.OneToMany)((()=>story_entity_1.Story),(story=>story.country)),tslib_1.__metadata("design:type",Array)],Country.prototype,"stories",void 0),Country=tslib_1.__decorate([(0,typeorm_1.Entity)()],Country),exports.Country=Country},856:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateRaceDto=void 0;exports.CreateRaceDto=class CreateRaceDto{}},1406:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.DeleteResultDto=void 0;exports.DeleteResultDto=class DeleteResultDto{}},1100:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UpdateRaceDto=void 0;const mapped_types_1=__webpack_require__(2568),create_race_dto_1=__webpack_require__(856);class UpdateRaceDto extends((0,mapped_types_1.PartialType)(create_race_dto_1.CreateRaceDto)){}exports.UpdateRaceDto=UpdateRaceDto},2074:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Race=void 0;const tslib_1=__webpack_require__(752),typeorm_1=__webpack_require__(5250),country_entity_1=__webpack_require__(6281),result_entity_1=__webpack_require__(633);let Race=class Race{};tslib_1.__decorate([(0,typeorm_1.PrimaryGeneratedColumn)(),tslib_1.__metadata("design:type",Number)],Race.prototype,"id",void 0),tslib_1.__decorate([(0,typeorm_1.OneToMany)((()=>result_entity_1.Result),(result=>result.race)),tslib_1.__metadata("design:type",Array)],Race.prototype,"results",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],Race.prototype,"title",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],Race.prototype,"place",void 0),tslib_1.__decorate([(0,typeorm_1.ManyToOne)((()=>country_entity_1.Country),(country=>country.stories)),tslib_1.__metadata("design:type","function"==typeof(_a=void 0!==country_entity_1.Country&&country_entity_1.Country)?_a:Object)],Race.prototype,"country",void 0),tslib_1.__decorate([(0,typeorm_1.Column)({type:"date"}),tslib_1.__metadata("design:type","function"==typeof(_b="undefined"!=typeof Date&&Date)?_b:Object)],Race.prototype,"date",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],Race.prototype,"text",void 0),tslib_1.__decorate([(0,typeorm_1.Column)("simple-array",{nullable:!0}),tslib_1.__metadata("design:type",Array)],Race.prototype,"imgNames",void 0),tslib_1.__decorate([(0,typeorm_1.Column)({default:!1}),tslib_1.__metadata("design:type",Boolean)],Race.prototype,"podium",void 0),tslib_1.__decorate([(0,typeorm_1.Column)({default:!1}),tslib_1.__metadata("design:type",Boolean)],Race.prototype,"show",void 0),Race=tslib_1.__decorate([(0,typeorm_1.Entity)()],Race),exports.Race=Race},908:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d,_e,_f,_g,_h;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RacesController=exports.storage=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),races_service_1=__webpack_require__(8953),create_race_dto_1=__webpack_require__(856),update_race_dto_1=__webpack_require__(1100),platform_express_1=__webpack_require__(6188),express_1=__webpack_require__(6860),multer_1=__webpack_require__(1738),uuid_1=__webpack_require__(5828),path=__webpack_require__(1017),path_1=__webpack_require__(1017),create_result_dto_1=__webpack_require__(3441),delete_result_dto_1=__webpack_require__(1406);exports.storage={storage:(0,multer_1.diskStorage)({destination:"./upload/races",filename:(req,file,cb)=>{cb(null,`${path.parse(file.originalname).name.replace(/\s/g,"")+(0,uuid_1.v4)()}${path.parse(file.originalname).ext}`)}})};let RacesController=class RacesController{constructor(racesService){this.racesService=racesService}create(createRaceDto){return this.racesService.create(createRaceDto)}findAll(){return this.racesService.findAllChecked()}findAllShow(){return this.racesService.findAll()}getMap(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.racesService.getMap()}))}getYears(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.racesService.getYears()}))}getCalendar(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.racesService.getCalendar()}))}findOne(id){return this.racesService.findOne(+id)}update(id,updateRaceDto){return this.racesService.update(+id,updateRaceDto)}remove(id){return this.racesService.remove(+id)}uploadProfilePicture(id,file){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.racesService.addPicture(+id,file.filename),{imagePath:file.filename}}))}findProfileImage(fileName,res){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return res.sendFile((0,path_1.join)(process.cwd(),"upload/races/"+fileName))}))}addResult(id,createResultDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.racesService.addResult(+id,createResultDto)}))}deleteResult(id,deleteResultDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.racesService.deleteResult(+id,deleteResultDto.resultId)}))}};tslib_1.__decorate([(0,common_1.Post)(),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==create_race_dto_1.CreateRaceDto&&create_race_dto_1.CreateRaceDto)?_a:Object]),tslib_1.__metadata("design:returntype",void 0)],RacesController.prototype,"create",null),tslib_1.__decorate([(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],RacesController.prototype,"findAll",null),tslib_1.__decorate([(0,common_1.Get)("all"),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],RacesController.prototype,"findAllShow",null),tslib_1.__decorate([(0,common_1.Get)("map"),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",Promise)],RacesController.prototype,"getMap",null),tslib_1.__decorate([(0,common_1.Get)("years"),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",Promise)],RacesController.prototype,"getYears",null),tslib_1.__decorate([(0,common_1.Get)("calendar"),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",Promise)],RacesController.prototype,"getCalendar",null),tslib_1.__decorate([(0,common_1.Get)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],RacesController.prototype,"findOne",null),tslib_1.__decorate([(0,common_1.Patch)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__param(1,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_b=void 0!==update_race_dto_1.UpdateRaceDto&&update_race_dto_1.UpdateRaceDto)?_b:Object]),tslib_1.__metadata("design:returntype",void 0)],RacesController.prototype,"update",null),tslib_1.__decorate([(0,common_1.Delete)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],RacesController.prototype,"remove",null),tslib_1.__decorate([(0,common_1.Post)("upload/:id"),(0,common_1.UseInterceptors)((0,platform_express_1.FileInterceptor)("file",exports.storage)),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__param(1,(0,common_1.UploadedFile)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_d=void 0!==express_1.Express&&void 0!==(_c=express_1.Express.Multer)&&_c.File)?_d:Object]),tslib_1.__metadata("design:returntype",Promise)],RacesController.prototype,"uploadProfilePicture",null),tslib_1.__decorate([(0,common_1.Get)("image/:fileName"),tslib_1.__param(0,(0,common_1.Param)("fileName")),tslib_1.__param(1,(0,common_1.Res)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_e=void 0!==express_1.Response&&express_1.Response)?_e:Object]),tslib_1.__metadata("design:returntype",Promise)],RacesController.prototype,"findProfileImage",null),tslib_1.__decorate([(0,common_1.Patch)("add-result/:id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__param(1,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_f=void 0!==create_result_dto_1.CreateResultDto&&create_result_dto_1.CreateResultDto)?_f:Object]),tslib_1.__metadata("design:returntype",Promise)],RacesController.prototype,"addResult",null),tslib_1.__decorate([(0,common_1.Patch)("delete-result/:id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__param(1,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_g=void 0!==delete_result_dto_1.DeleteResultDto&&delete_result_dto_1.DeleteResultDto)?_g:Object]),tslib_1.__metadata("design:returntype",Promise)],RacesController.prototype,"deleteResult",null),RacesController=tslib_1.__decorate([(0,common_1.Controller)("myrace"),tslib_1.__metadata("design:paramtypes",["function"==typeof(_h=void 0!==races_service_1.RacesService&&races_service_1.RacesService)?_h:Object])],RacesController),exports.RacesController=RacesController},4514:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.RacesModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),races_service_1=__webpack_require__(8953),races_controller_1=__webpack_require__(908),typeorm_1=__webpack_require__(3399),race_entity_1=__webpack_require__(2074),country_entity_1=__webpack_require__(6281),country_service_1=__webpack_require__(6193),result_entity_1=__webpack_require__(633),age_category_entity_1=__webpack_require__(1628),riders_service_1=__webpack_require__(198),rider_entity_1=__webpack_require__(5321),result_service_1=__webpack_require__(3165),age_category_service_1=__webpack_require__(6153);let RacesModule=class RacesModule{};RacesModule=tslib_1.__decorate([(0,common_1.Module)({imports:[typeorm_1.TypeOrmModule.forFeature([race_entity_1.Race,country_entity_1.Country,result_entity_1.Result,age_category_entity_1.AgeCategory,rider_entity_1.Rider])],controllers:[races_controller_1.RacesController],providers:[races_service_1.RacesService,country_service_1.CountryService,riders_service_1.RidersService,result_service_1.ResultService,age_category_service_1.AgeCategoryService]})],RacesModule),exports.RacesModule=RacesModule},8953:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RacesService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),typeorm_1=__webpack_require__(3399),typeorm_2=__webpack_require__(5250),country_service_1=__webpack_require__(6193),result_service_1=__webpack_require__(3165),race_entity_1=__webpack_require__(2074),fs=__webpack_require__(7147);let RacesService=class RacesService{constructor(raceRepository,countryService,resultService){this.raceRepository=raceRepository,this.countryService=countryService,this.resultService=resultService}create(createRaceDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const race=this.raceRepository.create(createRaceDto);race.imgNames||(race.imgNames=[]);const country=yield this.countryService.findOne(createRaceDto.countryId);if(!country)return new common_1.NotFoundException(`Country with id ${createRaceDto.countryId} was not found.}`);race.country=country,race.podium=!1;const results=[];if(createRaceDto.results)for(let i=0;i<createRaceDto.results.length;i++){const resultDto=createRaceDto.results[i];try{const result=yield this.resultService.create(resultDto);(result.acResult<4||result.result<4)&&(race.podium=!0),results.push(result)}catch(err){throw new common_1.BadRequestException(err)}}return race.results=results,yield this.raceRepository.save(race)}))}findAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.raceRepository.find({relations:["country","results","results.rider","results.ageCategory"]})}))}findAllChecked(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.raceRepository.find({where:{show:!0},relations:["country","results","results.rider","results.ageCategory"]})}))}findOne(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const race=yield this.raceRepository.findOne({where:{id},relations:["country","results","results.rider","results.ageCategory"]});if(!race)throw new common_1.NotFoundException("Race was not found");return race}))}update(id,updateRaceDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const race=yield this.raceRepository.findOneBy({id});if(!race)return;if(updateRaceDto.countryId){const countryEntity=yield this.countryService.findOne(updateRaceDto.countryId);if(!countryEntity)throw new common_1.BadRequestException("Country nof found");race.country=countryEntity}if(updateRaceDto.imgNames){const diff=race.imgNames.filter((item=>{if(updateRaceDto.imgNames)return updateRaceDto.imgNames.indexOf(item)<0}));this.deletePictures(diff)}const newRace=Object.assign(Object.assign({},race),updateRaceDto);return yield this.raceRepository.update(id,newRace),newRace}))}remove(id){return this.raceRepository.delete(id)}getMap(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const races=yield this.findAllChecked(),map={};for(const race of races){const year=new Date(race.date).getFullYear();map[year]||(map[year]=[]),map[year].push(race)}return map}))}getMapAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const races=yield this.findAll(),map={};for(const race of races){const year=new Date(race.date).getFullYear();map[year]||(map[year]=[]),map[year].push(race)}return map}))}getYears(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const map=yield this.getMap();return Object.keys(map)}))}addPicture(id,filename){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const story=yield this.raceRepository.findOneBy({id});if(!story)return;let images=story.imgNames;return images||(images=[]),images.push(filename),yield this.raceRepository.update(id,{imgNames:images})}))}deletePictures(filenames){return tslib_1.__awaiter(this,void 0,void 0,(function*(){filenames.forEach((filename=>{this.deletePicture(filename)}))}))}deletePicture(filename){return tslib_1.__awaiter(this,void 0,void 0,(function*(){fs.unlink(`./upload/races/${filename}`,(err=>{err&&console.error(err)}))}))}addResult(raceId,createResultDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(raceId&&createResultDto)try{const race=yield this.raceRepository.findOne({where:{id:raceId},relations:["results","results.rider","results.ageCategory"]});if(!race)return new common_1.NotFoundException("Race was not found");const results=race.results,result=yield this.resultService.create(createResultDto);if(!result)return new common_1.NotFoundException("Could not create result entity");results.push(result);let podium=race.podium;return(result.acResult<4||result.result<4)&&(podium=!0),yield this.raceRepository.update(raceId,{podium})}catch(err){throw console.error(err),new common_1.BadRequestException(err)}}))}deleteResult(id,resultId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(id&&resultId)try{yield this.resultService.remove(resultId);const race=yield this.raceRepository.findOne({where:{id},relations:["results"]});if(!race)return new common_1.NotFoundException("Race was not found");let podium=!1;for(let i=0;i<race.results.length;i++){const result=race.results[i];(result.acResult<4||result.result<4)&&(podium=!0)}return yield this.raceRepository.update(id,{podium})}catch(err){throw console.error(err),new common_1.BadRequestException("Something went wrong")}}))}getCalendar(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const records={},map=yield this.getMapAll(),years=Object.keys(map);for(let i=0;i<years.length;i++){const year=years[i],races=map[year],monthDateRecord={};for(let j=0;j<races.length;j++){const race=races[j];if(!race)continue;const date=new Date(race.date),day=date.getDate(),month=date.getMonth();monthDateRecord[month]||(monthDateRecord[month]={}),monthDateRecord[month][day]||(monthDateRecord[month][day]=[]);let link="races/-1";race.show&&(link=`races/${race.id}`),monthDateRecord[month][day].push([race.title,link])}records[year]=monthDateRecord}return records}))}};RacesService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,typeorm_1.InjectRepository)(race_entity_1.Race)),tslib_1.__param(2,(0,common_1.Inject)((0,common_1.forwardRef)((()=>result_service_1.ResultService)))),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==typeorm_2.Repository&&typeorm_2.Repository)?_a:Object,"function"==typeof(_b=void 0!==country_service_1.CountryService&&country_service_1.CountryService)?_b:Object,"function"==typeof(_c=void 0!==result_service_1.ResultService&&result_service_1.ResultService)?_c:Object])],RacesService),exports.RacesService=RacesService},3441:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateResultDto=void 0;exports.CreateResultDto=class CreateResultDto{}},2611:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UpdateResultDto=void 0;const mapped_types_1=__webpack_require__(2568),create_result_dto_1=__webpack_require__(3441);class UpdateResultDto extends((0,mapped_types_1.PartialType)(create_result_dto_1.CreateResultDto)){}exports.UpdateResultDto=UpdateResultDto},633:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Result=void 0;const tslib_1=__webpack_require__(752),typeorm_1=__webpack_require__(5250),rider_entity_1=__webpack_require__(5321),age_category_entity_1=__webpack_require__(1628),race_entity_1=__webpack_require__(2074);let Result=class Result{};tslib_1.__decorate([(0,typeorm_1.PrimaryGeneratedColumn)(),tslib_1.__metadata("design:type",Number)],Result.prototype,"id",void 0),tslib_1.__decorate([(0,typeorm_1.ManyToOne)((()=>rider_entity_1.Rider),(rider=>rider.results)),tslib_1.__metadata("design:type","function"==typeof(_a=void 0!==rider_entity_1.Rider&&rider_entity_1.Rider)?_a:Object)],Result.prototype,"rider",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",Number)],Result.prototype,"result",void 0),tslib_1.__decorate([(0,typeorm_1.ManyToOne)((()=>age_category_entity_1.AgeCategory),(ageCategory=>ageCategory.results)),tslib_1.__metadata("design:type","function"==typeof(_b=void 0!==age_category_entity_1.AgeCategory&&age_category_entity_1.AgeCategory)?_b:Object)],Result.prototype,"ageCategory",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",Number)],Result.prototype,"acResult",void 0),tslib_1.__decorate([(0,typeorm_1.ManyToOne)((()=>race_entity_1.Race),(race=>race.results),{onDelete:"CASCADE"}),(0,typeorm_1.JoinColumn)(),tslib_1.__metadata("design:type","function"==typeof(_c=void 0!==race_entity_1.Race&&race_entity_1.Race)?_c:Object)],Result.prototype,"race",void 0),Result=tslib_1.__decorate([(0,typeorm_1.Entity)()],Result),exports.Result=Result},5668:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ResultController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),result_service_1=__webpack_require__(3165),create_result_dto_1=__webpack_require__(3441),update_result_dto_1=__webpack_require__(2611);let ResultController=class ResultController{constructor(resultService){this.resultService=resultService}create(createResultDto){return this.resultService.create(createResultDto)}findAll(){return this.resultService.findAll()}findOne(id){return this.resultService.findOne(+id)}update(id,updateResultDto){return this.resultService.update(+id,updateResultDto)}remove(id){return this.resultService.remove(+id)}};tslib_1.__decorate([(0,common_1.Post)(),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==create_result_dto_1.CreateResultDto&&create_result_dto_1.CreateResultDto)?_a:Object]),tslib_1.__metadata("design:returntype",void 0)],ResultController.prototype,"create",null),tslib_1.__decorate([(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],ResultController.prototype,"findAll",null),tslib_1.__decorate([(0,common_1.Get)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],ResultController.prototype,"findOne",null),tslib_1.__decorate([(0,common_1.Patch)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__param(1,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_b=void 0!==update_result_dto_1.UpdateResultDto&&update_result_dto_1.UpdateResultDto)?_b:Object]),tslib_1.__metadata("design:returntype",void 0)],ResultController.prototype,"update",null),tslib_1.__decorate([(0,common_1.Delete)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],ResultController.prototype,"remove",null),ResultController=tslib_1.__decorate([(0,common_1.Controller)("result"),tslib_1.__metadata("design:paramtypes",["function"==typeof(_c=void 0!==result_service_1.ResultService&&result_service_1.ResultService)?_c:Object])],ResultController),exports.ResultController=ResultController},4794:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.ResultModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),result_service_1=__webpack_require__(3165),result_controller_1=__webpack_require__(5668),riders_service_1=__webpack_require__(198),result_entity_1=__webpack_require__(633),typeorm_1=__webpack_require__(3399),rider_entity_1=__webpack_require__(5321),country_entity_1=__webpack_require__(6281),country_service_1=__webpack_require__(6193),age_category_service_1=__webpack_require__(6153),race_entity_1=__webpack_require__(2074),age_category_entity_1=__webpack_require__(1628),races_service_1=__webpack_require__(8953);let ResultModule=class ResultModule{};ResultModule=tslib_1.__decorate([(0,common_1.Module)({imports:[typeorm_1.TypeOrmModule.forFeature([result_entity_1.Result,rider_entity_1.Rider,country_entity_1.Country,race_entity_1.Race,age_category_entity_1.AgeCategory])],controllers:[result_controller_1.ResultController],providers:[result_service_1.ResultService,riders_service_1.RidersService,country_service_1.CountryService,age_category_service_1.AgeCategoryService,races_service_1.RacesService]})],ResultModule),exports.ResultModule=ResultModule},3165:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ResultService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),typeorm_1=__webpack_require__(3399),typeorm_2=__webpack_require__(5250),age_category_service_1=__webpack_require__(6153),races_service_1=__webpack_require__(8953),riders_service_1=__webpack_require__(198),result_entity_1=__webpack_require__(633);let ResultService=class ResultService{constructor(resultRepository,riderService,ageCategoryService,raceService){this.resultRepository=resultRepository,this.riderService=riderService,this.ageCategoryService=ageCategoryService,this.raceService=raceService}create(createResultDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const race=yield this.raceService.findOne(createResultDto.raceId);if(!race)throw new common_1.BadRequestException("Race does not exists");const rider=yield this.riderService.findOne(createResultDto.riderId);if(!rider)throw new common_1.BadRequestException("Rider does not exists");const ageCategory=yield this.ageCategoryService.findOne(createResultDto.ageCategoryId);if(!ageCategory)throw new common_1.BadRequestException("Age category does not exists");const result=this.resultRepository.create(createResultDto);return result.rider=rider,result.race=race,result.ageCategory=ageCategory,yield this.resultRepository.save(result)}))}findAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.resultRepository.find({relations:["rider","ageCategory","race"]})}))}findOne(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.resultRepository.findOne({where:{id},relations:["rider","ageCategory","race"]})}))}findAllIds(ids){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const results=[];for(let i=0;i<ids.length;i++){const id=ids[i],result=yield this.findOne(id);result&&results.push(result)}return results}))}update(id,updateResultDto){return`This action updates a #${id} result`}remove(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.resultRepository.delete(id)}))}};ResultService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,typeorm_1.InjectRepository)(result_entity_1.Result)),tslib_1.__param(3,(0,common_1.Inject)((0,common_1.forwardRef)((()=>races_service_1.RacesService)))),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==typeorm_2.Repository&&typeorm_2.Repository)?_a:Object,"function"==typeof(_b=void 0!==riders_service_1.RidersService&&riders_service_1.RidersService)?_b:Object,"function"==typeof(_c=void 0!==age_category_service_1.AgeCategoryService&&age_category_service_1.AgeCategoryService)?_c:Object,"function"==typeof(_d=void 0!==races_service_1.RacesService&&races_service_1.RacesService)?_d:Object])],ResultService),exports.ResultService=ResultService},2868:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateRiderDto=void 0;exports.CreateRiderDto=class CreateRiderDto{}},5772:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UpdateRiderDto=void 0;const mapped_types_1=__webpack_require__(2568),create_rider_dto_1=__webpack_require__(2868);class UpdateRiderDto extends((0,mapped_types_1.PartialType)(create_rider_dto_1.CreateRiderDto)){}exports.UpdateRiderDto=UpdateRiderDto},5321:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Rider=void 0;const tslib_1=__webpack_require__(752),typeorm_1=__webpack_require__(5250),country_entity_1=__webpack_require__(6281),result_entity_1=__webpack_require__(633);let Rider=class Rider{};tslib_1.__decorate([(0,typeorm_1.PrimaryGeneratedColumn)(),tslib_1.__metadata("design:type",Number)],Rider.prototype,"id",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],Rider.prototype,"name",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],Rider.prototype,"surname",void 0),tslib_1.__decorate([(0,typeorm_1.ManyToOne)((()=>country_entity_1.Country),(country=>country.riders)),tslib_1.__metadata("design:type","function"==typeof(_a=void 0!==country_entity_1.Country&&country_entity_1.Country)?_a:Object)],Rider.prototype,"country",void 0),tslib_1.__decorate([(0,typeorm_1.Column)({default:"profile.jpg"}),tslib_1.__metadata("design:type",String)],Rider.prototype,"imgName",void 0),tslib_1.__decorate([(0,typeorm_1.OneToMany)((()=>result_entity_1.Result),(result=>result.rider)),tslib_1.__metadata("design:type",Array)],Rider.prototype,"results",void 0),Rider=tslib_1.__decorate([(0,typeorm_1.Entity)()],Rider),exports.Rider=Rider},4502:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d,_e,_f;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RidersController=exports.storage=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),riders_service_1=__webpack_require__(198),create_rider_dto_1=__webpack_require__(2868),update_rider_dto_1=__webpack_require__(5772),platform_express_1=__webpack_require__(6188),express_1=__webpack_require__(6860),multer_1=__webpack_require__(1738),uuid_1=__webpack_require__(5828),path=__webpack_require__(1017),path_1=__webpack_require__(1017);exports.storage={storage:(0,multer_1.diskStorage)({destination:"./upload/riders",filename:(req,file,cb)=>{cb(null,`${path.parse(file.originalname).name.replace(/\s/g,"")+(0,uuid_1.v4)()}${path.parse(file.originalname).ext}`)}})};let RidersController=class RidersController{constructor(ridersService){this.ridersService=ridersService}create(createRiderDto){return this.ridersService.create(createRiderDto)}findAll(){return this.ridersService.findAll()}findOne(id){return this.ridersService.findOne(+id)}update(id,updateRiderDto){return this.ridersService.update(+id,updateRiderDto)}uploadProfilePicture(id,file){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.ridersService.updateProfilePicture(+id,file.filename),{imagePath:file.filename}}))}deleteProfilePicture(id){return this.ridersService.deleteProfilePicture(+id)}findProfileImage(fileName,res){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return res.sendFile((0,path_1.join)(process.cwd(),"upload/riders/"+fileName))}))}remove(id){return this.ridersService.remove(+id)}};tslib_1.__decorate([(0,common_1.Post)(),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==create_rider_dto_1.CreateRiderDto&&create_rider_dto_1.CreateRiderDto)?_a:Object]),tslib_1.__metadata("design:returntype",void 0)],RidersController.prototype,"create",null),tslib_1.__decorate([(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],RidersController.prototype,"findAll",null),tslib_1.__decorate([(0,common_1.Get)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],RidersController.prototype,"findOne",null),tslib_1.__decorate([(0,common_1.Patch)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__param(1,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_b=void 0!==update_rider_dto_1.UpdateRiderDto&&update_rider_dto_1.UpdateRiderDto)?_b:Object]),tslib_1.__metadata("design:returntype",void 0)],RidersController.prototype,"update",null),tslib_1.__decorate([(0,common_1.Post)("upload/:id"),(0,common_1.UseInterceptors)((0,platform_express_1.FileInterceptor)("file",exports.storage)),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__param(1,(0,common_1.UploadedFile)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_d=void 0!==express_1.Express&&void 0!==(_c=express_1.Express.Multer)&&_c.File)?_d:Object]),tslib_1.__metadata("design:returntype",Promise)],RidersController.prototype,"uploadProfilePicture",null),tslib_1.__decorate([(0,common_1.Delete)(),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],RidersController.prototype,"deleteProfilePicture",null),tslib_1.__decorate([(0,common_1.Get)("image/:fileName"),tslib_1.__param(0,(0,common_1.Param)("fileName")),tslib_1.__param(1,(0,common_1.Res)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_e=void 0!==express_1.Response&&express_1.Response)?_e:Object]),tslib_1.__metadata("design:returntype",Promise)],RidersController.prototype,"findProfileImage",null),tslib_1.__decorate([(0,common_1.Delete)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],RidersController.prototype,"remove",null),RidersController=tslib_1.__decorate([(0,common_1.Controller)("riders"),tslib_1.__metadata("design:paramtypes",["function"==typeof(_f=void 0!==riders_service_1.RidersService&&riders_service_1.RidersService)?_f:Object])],RidersController),exports.RidersController=RidersController},9437:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.RidersModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),riders_service_1=__webpack_require__(198),riders_controller_1=__webpack_require__(4502),rider_entity_1=__webpack_require__(5321),typeorm_1=__webpack_require__(3399),country_service_1=__webpack_require__(6193),country_entity_1=__webpack_require__(6281);let RidersModule=class RidersModule{};RidersModule=tslib_1.__decorate([(0,common_1.Module)({imports:[typeorm_1.TypeOrmModule.forFeature([rider_entity_1.Rider,country_entity_1.Country])],controllers:[riders_controller_1.RidersController],providers:[riders_service_1.RidersService,country_service_1.CountryService]})],RidersModule),exports.RidersModule=RidersModule},198:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RidersService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),rider_entity_1=__webpack_require__(5321),typeorm_1=__webpack_require__(5250),typeorm_2=__webpack_require__(3399),country_service_1=__webpack_require__(6193),fs=__webpack_require__(7147);let RidersService=class RidersService{constructor(ridersRepository,countryService){this.ridersRepository=ridersRepository,this.countryService=countryService}create(createRiderDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const rider=this.ridersRepository.create(createRiderDto);return yield this.ridersRepository.save(rider),rider}))}findAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const riders=yield this.ridersRepository.find({relations:["country"]});return riders.sort(((a,b)=>a.id-b.id)),riders}))}findOne(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(!id)throw new common_1.InternalServerErrorException("ID is undefined");const rider=yield this.ridersRepository.find({where:{id},relations:["country"]});if(0!==rider.length)return rider[0]}))}update(id,updateRiderDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const rider=yield this.ridersRepository.findOneBy({id});if(!rider)return;const country=updateRiderDto.country;if(country){const countryEntity=yield this.countryService.findOne(country.id);if(!countryEntity)return;rider.country=countryEntity}const newRider=Object.assign(Object.assign({},rider),updateRiderDto);return yield this.ridersRepository.update(id,newRider)}))}remove(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const rider=yield this.ridersRepository.findOneBy({id});if(rider)return this.deleteProfileImage(rider),yield this.ridersRepository.delete(id)}))}updateProfilePicture(id,filename){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const rider=yield this.ridersRepository.findOneBy({id});if(rider)return this.deleteProfileImage(rider),yield this.ridersRepository.update(id,{imgName:filename})}))}deleteProfilePicture(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(yield this.ridersRepository.findOneBy({id}))return yield this.ridersRepository.update(id,{imgName:"profile.jpg"})}))}getProfilePictureName(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const rider=yield this.ridersRepository.findOneBy({id});if(rider)return rider.imgName}))}deleteProfileImage(rider){if("profile.jpg"===rider.imgName)return;fs.unlink(`./upload/riders/${rider.imgName}`,(err=>{err&&console.error(err)}))}};RidersService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,typeorm_2.InjectRepository)(rider_entity_1.Rider)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==typeorm_1.Repository&&typeorm_1.Repository)?_a:Object,"function"==typeof(_b=void 0!==country_service_1.CountryService&&country_service_1.CountryService)?_b:Object])],RidersService),exports.RidersService=RidersService},1402:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateStoryDto=void 0;exports.CreateStoryDto=class CreateStoryDto{}},9927:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UpdateStoryDto=void 0;const mapped_types_1=__webpack_require__(2568),create_story_dto_1=__webpack_require__(1402);class UpdateStoryDto extends((0,mapped_types_1.PartialType)(create_story_dto_1.CreateStoryDto)){}exports.UpdateStoryDto=UpdateStoryDto},376:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Story=void 0;const tslib_1=__webpack_require__(752),typeorm_1=__webpack_require__(5250),country_entity_1=__webpack_require__(6281);let Story=class Story{};tslib_1.__decorate([(0,typeorm_1.PrimaryGeneratedColumn)(),tslib_1.__metadata("design:type",Number)],Story.prototype,"id",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],Story.prototype,"title",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],Story.prototype,"place",void 0),tslib_1.__decorate([(0,typeorm_1.ManyToOne)((()=>country_entity_1.Country),(country=>country.stories)),tslib_1.__metadata("design:type","function"==typeof(_a=void 0!==country_entity_1.Country&&country_entity_1.Country)?_a:Object)],Story.prototype,"country",void 0),tslib_1.__decorate([(0,typeorm_1.Column)({type:"date"}),tslib_1.__metadata("design:type","function"==typeof(_b="undefined"!=typeof Date&&Date)?_b:Object)],Story.prototype,"date",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],Story.prototype,"text",void 0),tslib_1.__decorate([(0,typeorm_1.Column)("simple-array",{nullable:!0}),tslib_1.__metadata("design:type",Array)],Story.prototype,"imgNames",void 0),tslib_1.__decorate([(0,typeorm_1.Column)({default:!1}),tslib_1.__metadata("design:type",Boolean)],Story.prototype,"podium",void 0),tslib_1.__decorate([(0,typeorm_1.Column)({default:!1}),tslib_1.__metadata("design:type",Boolean)],Story.prototype,"show",void 0),Story=tslib_1.__decorate([(0,typeorm_1.Entity)()],Story),exports.Story=Story},5152:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d,_e,_f;Object.defineProperty(exports,"__esModule",{value:!0}),exports.StoriesController=exports.storage=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),stories_service_1=__webpack_require__(4120),create_story_dto_1=__webpack_require__(1402),update_story_dto_1=__webpack_require__(9927),platform_express_1=__webpack_require__(6188),express_1=__webpack_require__(6860),multer_1=__webpack_require__(1738),uuid_1=__webpack_require__(5828),path=__webpack_require__(1017),path_1=__webpack_require__(1017);exports.storage={storage:(0,multer_1.diskStorage)({destination:"./upload/stories",filename:(req,file,cb)=>{cb(null,`${path.parse(file.originalname).name.replace(/\s/g,"")+(0,uuid_1.v4)()}${path.parse(file.originalname).ext}`)}})};let StoriesController=class StoriesController{constructor(storiesService){this.storiesService=storiesService}create(createStoryDto){return this.storiesService.create(createStoryDto)}findAll(){return this.storiesService.findAllChecked()}findAllShow(){return this.storiesService.findAll()}getMap(){return this.storiesService.getMap()}getYears(){return this.storiesService.getYears()}getCalendar(){return this.storiesService.getCalendar()}findOne(id){return this.storiesService.findOne(+id)}update(id,updateStoryDto){return this.storiesService.update(+id,updateStoryDto)}remove(id){return this.storiesService.remove(+id)}uploadProfilePicture(id,file){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.storiesService.addPicture(+id,file.filename),{imagePath:file.filename}}))}findProfileImage(fileName,res){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return res.sendFile((0,path_1.join)(process.cwd(),"upload/stories/"+fileName))}))}};tslib_1.__decorate([(0,common_1.Post)(),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==create_story_dto_1.CreateStoryDto&&create_story_dto_1.CreateStoryDto)?_a:Object]),tslib_1.__metadata("design:returntype",void 0)],StoriesController.prototype,"create",null),tslib_1.__decorate([(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],StoriesController.prototype,"findAll",null),tslib_1.__decorate([(0,common_1.Get)("all"),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],StoriesController.prototype,"findAllShow",null),tslib_1.__decorate([(0,common_1.Get)("map"),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],StoriesController.prototype,"getMap",null),tslib_1.__decorate([(0,common_1.Get)("years"),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],StoriesController.prototype,"getYears",null),tslib_1.__decorate([(0,common_1.Get)("calendar"),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],StoriesController.prototype,"getCalendar",null),tslib_1.__decorate([(0,common_1.Get)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],StoriesController.prototype,"findOne",null),tslib_1.__decorate([(0,common_1.Patch)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__param(1,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_b=void 0!==update_story_dto_1.UpdateStoryDto&&update_story_dto_1.UpdateStoryDto)?_b:Object]),tslib_1.__metadata("design:returntype",void 0)],StoriesController.prototype,"update",null),tslib_1.__decorate([(0,common_1.Delete)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],StoriesController.prototype,"remove",null),tslib_1.__decorate([(0,common_1.Post)("upload/:id"),(0,common_1.UseInterceptors)((0,platform_express_1.FileInterceptor)("file",exports.storage)),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__param(1,(0,common_1.UploadedFile)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_d=void 0!==express_1.Express&&void 0!==(_c=express_1.Express.Multer)&&_c.File)?_d:Object]),tslib_1.__metadata("design:returntype",Promise)],StoriesController.prototype,"uploadProfilePicture",null),tslib_1.__decorate([(0,common_1.Get)("image/:fileName"),tslib_1.__param(0,(0,common_1.Param)("fileName")),tslib_1.__param(1,(0,common_1.Res)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_e=void 0!==express_1.Response&&express_1.Response)?_e:Object]),tslib_1.__metadata("design:returntype",Promise)],StoriesController.prototype,"findProfileImage",null),StoriesController=tslib_1.__decorate([(0,common_1.Controller)("story"),tslib_1.__metadata("design:paramtypes",["function"==typeof(_f=void 0!==stories_service_1.StoriesService&&stories_service_1.StoriesService)?_f:Object])],StoriesController),exports.StoriesController=StoriesController},5057:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.StoriesModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),stories_service_1=__webpack_require__(4120),stories_controller_1=__webpack_require__(5152),typeorm_1=__webpack_require__(3399),country_service_1=__webpack_require__(6193),story_entity_1=__webpack_require__(376),country_entity_1=__webpack_require__(6281);let StoriesModule=class StoriesModule{};StoriesModule=tslib_1.__decorate([(0,common_1.Module)({imports:[typeorm_1.TypeOrmModule.forFeature([story_entity_1.Story,country_entity_1.Country])],controllers:[stories_controller_1.StoriesController],providers:[stories_service_1.StoriesService,country_service_1.CountryService]})],StoriesModule),exports.StoriesModule=StoriesModule},4120:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.StoriesService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),typeorm_1=__webpack_require__(3399),typeorm_2=__webpack_require__(5250),country_service_1=__webpack_require__(6193),story_entity_1=__webpack_require__(376),fs=__webpack_require__(7147);let StoriesService=class StoriesService{constructor(storiesRepository,countryService){this.storiesRepository=storiesRepository,this.countryService=countryService}create(createStoryDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const story=this.storiesRepository.create(createStoryDto);return story.imgNames||(story.imgNames=[]),yield this.storiesRepository.save(story)}))}findAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.storiesRepository.find({relations:["country"]})}))}findAllChecked(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.storiesRepository.find({where:{show:!0},relations:["country"]})}))}findOne(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const story=yield this.storiesRepository.findOne({where:{id},relations:["country"]});return story||new common_1.NotFoundException}))}update(id,updateStoryDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const story=yield this.storiesRepository.findOneBy({id});if(!story)return;const country=updateStoryDto.country;if(country){const countryEntity=yield this.countryService.findOne(country.id);if(!countryEntity)return;story.country=countryEntity}if(updateStoryDto.imgNames){const diff=story.imgNames.filter((item=>{if(updateStoryDto.imgNames)return updateStoryDto.imgNames.indexOf(item)<0}));this.deletePictures(diff)}const newStory=Object.assign(Object.assign({},story),updateStoryDto);return yield this.storiesRepository.update(id,newStory),newStory}))}remove(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const story=yield this.storiesRepository.findOneBy({id});if(story)return this.deletePictures(story.imgNames),yield this.storiesRepository.delete({id})}))}addPicture(id,filename){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const story=yield this.storiesRepository.findOneBy({id});if(!story)return;let images=story.imgNames;return images||(images=[]),images.push(filename),yield this.storiesRepository.update(id,{imgNames:images})}))}deletePictures(filenames){return tslib_1.__awaiter(this,void 0,void 0,(function*(){filenames.forEach((filename=>{this.deletePicture(filename)}))}))}deletePicture(filename){return tslib_1.__awaiter(this,void 0,void 0,(function*(){fs.unlink(`./upload/stories/${filename}`,(err=>{err&&console.error(err)}))}))}getMap(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const stories=yield this.findAllChecked(),map={};for(const story of stories){const year=new Date(story.date).getFullYear();map[year]||(map[year]=[]),map[year].push(story)}return map}))}getMapAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const stories=yield this.findAll(),map={};for(const story of stories){const year=new Date(story.date).getFullYear();map[year]||(map[year]=[]),map[year].push(story)}return map}))}getYears(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const map=yield this.getMap();return Object.keys(map)}))}getCalendar(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const records={},map=yield this.getMapAll(),years=Object.keys(map);for(let i=0;i<years.length;i++){const year=years[i],stories=map[year],monthDateRecord={};for(let j=0;j<stories.length;j++){const story=stories[j];if(!story)continue;const date=new Date(story.date),day=date.getDate(),month=date.getMonth();monthDateRecord[month]||(monthDateRecord[month]={}),monthDateRecord[month][day]||(monthDateRecord[month][day]=[]);let link="stories/-1";story.show&&(link=`stories/${story.id}`),monthDateRecord[month][day].push([story.title,link])}records[year]=monthDateRecord}return records}))}};StoriesService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,typeorm_1.InjectRepository)(story_entity_1.Story)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==typeorm_2.Repository&&typeorm_2.Repository)?_a:Object,"function"==typeof(_b=void 0!==country_service_1.CountryService&&country_service_1.CountryService)?_b:Object])],StoriesService),exports.StoriesService=StoriesService},1501:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.User=void 0;const tslib_1=__webpack_require__(752),typeorm_1=__webpack_require__(5250),class_transformer_1=__webpack_require__(136);let User=class User{};tslib_1.__decorate([(0,typeorm_1.PrimaryGeneratedColumn)(),tslib_1.__metadata("design:type",Number)],User.prototype,"id",void 0),tslib_1.__decorate([(0,typeorm_1.PrimaryColumn)(),(0,class_transformer_1.Expose)(),tslib_1.__metadata("design:type",String)],User.prototype,"email",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),(0,class_transformer_1.Expose)(),tslib_1.__metadata("design:type",String)],User.prototype,"name",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],User.prototype,"password",void 0),tslib_1.__decorate([(0,typeorm_1.Column)({default:!1}),tslib_1.__metadata("design:type",Boolean)],User.prototype,"isActive",void 0),tslib_1.__decorate([(0,typeorm_1.Column)({nullable:!0}),(0,class_transformer_1.Exclude)(),tslib_1.__metadata("design:type",String)],User.prototype,"currentHashedRefreshToken",void 0),User=tslib_1.__decorate([(0,typeorm_1.Entity)(),(0,typeorm_1.Unique)(["email"])],User),exports.User=User},437:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d;Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),api_interfaces_1=__webpack_require__(7573),jwt_auth_guard_1=__webpack_require__(838),user_service_1=__webpack_require__(8081);let UserController=class UserController{constructor(usersService){this.usersService=usersService}getProfile(req){return this.usersService.getById(req.user.id)}getProfileById(id){return this.usersService.getById(id)}};tslib_1.__decorate([(0,common_1.Get)("profile"),(0,common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),tslib_1.__param(0,(0,common_1.Request)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==api_interfaces_1.RequestWithUser&&api_interfaces_1.RequestWithUser)?_a:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_b="undefined"!=typeof Promise&&Promise)?_b:Object)],UserController.prototype,"getProfile",null),tslib_1.__decorate([(0,common_1.Get)("profile/:id"),(0,common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Number]),tslib_1.__metadata("design:returntype","function"==typeof(_c="undefined"!=typeof Promise&&Promise)?_c:Object)],UserController.prototype,"getProfileById",null),UserController=tslib_1.__decorate([(0,common_1.Controller)("user"),(0,common_1.SerializeOptions)({strategy:"excludeAll"}),tslib_1.__metadata("design:paramtypes",["function"==typeof(_d=void 0!==user_service_1.UserService&&user_service_1.UserService)?_d:Object])],UserController),exports.UserController=UserController},5713:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),typeorm_1=__webpack_require__(3399),user_entity_1=__webpack_require__(1501),user_controller_1=__webpack_require__(437),user_service_1=__webpack_require__(8081);let UserModule=class UserModule{};UserModule=tslib_1.__decorate([(0,common_1.Module)({imports:[typeorm_1.TypeOrmModule.forFeature([user_entity_1.User])],providers:[user_service_1.UserService],exports:[user_service_1.UserService],controllers:[user_controller_1.UserController]})],UserModule),exports.UserModule=UserModule},8081:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),typeorm_1=__webpack_require__(3399),typeorm_2=__webpack_require__(5250),user_entity_1=__webpack_require__(1501),bcrypt=__webpack_require__(7096);let UserService=class UserService{constructor(usersRepository){this.usersRepository=usersRepository}getByEmail(email){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.usersRepository.findOne({where:{email}})}))}getById(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.usersRepository.findOne({where:{id}})}))}create(userData){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const newUser=this.usersRepository.create(userData);return yield this.usersRepository.save(newUser),newUser}))}setCurrentRefreshToken(refreshToken,userId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const currentHashedRefreshToken=yield bcrypt.hash(refreshToken,10);yield this.usersRepository.update({id:userId},{currentHashedRefreshToken})}))}removeRefreshToken(userId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.usersRepository.update({id:userId},{currentHashedRefreshToken:null})}))}getUserIfRefreshTokenMatches(refreshToken,userId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.getById(userId);if(!user)throw new common_1.HttpException(`User with id ${userId} does not exists`,common_1.HttpStatus.BAD_REQUEST);if(yield bcrypt.compare(refreshToken,user.currentHashedRefreshToken))return user}))}};UserService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,typeorm_1.InjectRepository)(user_entity_1.User)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==typeorm_2.Repository&&typeorm_2.Repository)?_a:Object])],UserService),exports.UserService=UserService},6481:module=>{module.exports=require("@nestjs/common")},5793:module=>{module.exports=require("@nestjs/config")},143:module=>{module.exports=require("@nestjs/core")},2064:module=>{module.exports=require("@nestjs/jwt")},2568:module=>{module.exports=require("@nestjs/mapped-types")},4340:module=>{module.exports=require("@nestjs/passport")},6188:module=>{module.exports=require("@nestjs/platform-express")},3399:module=>{module.exports=require("@nestjs/typeorm")},7096:module=>{module.exports=require("bcrypt")},136:module=>{module.exports=require("class-transformer")},5849:module=>{module.exports=require("class-validator")},9710:module=>{module.exports=require("cookie-parser")},6860:module=>{module.exports=require("express")},1738:module=>{module.exports=require("multer")},9849:module=>{module.exports=require("passport-jwt")},7055:module=>{module.exports=require("passport-local")},752:module=>{module.exports=require("tslib")},5250:module=>{module.exports=require("typeorm")},5828:module=>{module.exports=require("uuid")},7147:module=>{module.exports=require("fs")},1017:module=>{module.exports=require("path")}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}var __webpack_exports__={};(()=>{var exports=__webpack_exports__;Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),config_1=__webpack_require__(5793),core_1=__webpack_require__(143),cookieParser=__webpack_require__(9710),app_module_1=__webpack_require__(3292),environment_prod_1=__webpack_require__(7553);!function(){tslib_1.__awaiter(this,void 0,void 0,(function*(){const app=yield core_1.NestFactory.create(app_module_1.AppModule);environment_prod_1.environment.production&&app.enableCors({credentials:!0,origin:!0,methods:"GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS",allowedHeaders:["Content-Type","x-requested-with"]}),app.useGlobalPipes(new common_1.ValidationPipe),app.useGlobalInterceptors(new common_1.ClassSerializerInterceptor(app.get(core_1.Reflector))),app.use(cookieParser());app.setGlobalPrefix("tfb");const port=app.get(config_1.ConfigService).get("PORT")||3333;yield app.listen(port),common_1.Logger.log(` Application is running on: http://localhost:${port}/tfb`)}))}()})();var __webpack_export_target__=exports;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();
//# sourceMappingURL=main.js.map